#!/bin/sh
_update_paru_package_database() {
  printf "[paru]: update package database\n"
  paru -Syy --noconfirm 
  printf "[paru]: done\n\n"
}

_install_neovim() {
  printf "[neovim]: install\n"
  paru -S neovim --noconfirm 
  printf "[neovim]: done\n\n"
}

_install_treesitter() {
  printf "[treesitter]: install\n"
  paru -S treesitter --noconfirm 
  printf "[treesitter]: done\n\n"
}

_install_volta() {
  [ -z "$VOLTA_HOME" ] \
    && printf "[volta]: please set VOLTA_HOME env variable in your .zprofile"

  if [ ! "$(command -v volta)" ]; then
    printf "[volta]: install\n"
    volta_script="$XDG_CACHE_HOME"/volta.sh
    wget -q --show-progress https://get.volta.sh -O "$volta_script" 
    chmod +x "$volta_script"
    "$volta_script" --skip-setup  && rm "$volta_script"
    printf "[volta]: done\n\n"
  else
    printf "[volta]: skip already installed\n\n"
  fi
}

_install_node() {
  printf "[node-latest]: install\n"
  volta install node@latest 
  printf "[node-latest]: done\n\n"
}

_install_node_provider() {
  printf "[node-neovim]: install\n"
  volta install neovim 
  printf "[node-neovim]: done\n\n"
}

_install_python() {
  printf "[python]: install\n"
  paru -S python --noconfirm 
  printf "[python]: done\n\n"
}

_install_pip() {
  printf "[python-pip]: install\n"
  paru -S python-pip --noconfirm 
  printf "[python-pip]: done\n\n"
}

_install_python_provider() {
  printf "[python-neovim]: install\n"
  pip3 install --upgrade neovim 
  printf "[python-neovim]: done\n\n"
}

_install_ruby() {
  printf "[ruby]: install\n"
  paru -S ruby --noconfirm 
  printf "[ruby]: done\n\n"
}

_install_gem() {
  printf "[ruby-gem]: install\n"
  paru -S rubygems --noconfirm 
  printf "[ruby-gem]: done\n\n"
}

_install_ruby_provider() {
  printf "[ruby-provider]: install\n"
  gem install neovim 
  printf "[ruby-provider]: done\n\n"
}

_install_npm_packages() {
  printf "[npm-packages]: install\n"
  npm_packages_file="$XDG_CONFIG_HOME/nvim/scripts/npm_packages"
  if [ -e "$npm_packages_file" ]; then
    xargs volta install <"$npm_packages_file" 
    printf "[npm-packages]: done\n"
  else
    printf "[npm-packages]: %s not found\n" "$npm_packages_file"
  fi
}

_install_sumneko_lua() {
  printf "[lsp-sumneko]: install\n"
  paru -S lua-language-server --noconfirm 
  printf "[lsp-sumneko]: done\n"
}


_install_go() {
  printf "[go]: install\n"
  paru -S go --noconfirm 
  printf "[go]: done\n\n"
}

_install_gopls() {
  printf "[gopls]: install\n"
  paru -S gopls --noconfirm 
  printf "[gopls]: done\n\n"
}

_install_efm() {
  printf "[efm]: install\n"
  paru -S efm-langserver --noconfirm 
  printf "[efm]: done\n\n"
}

_install_clangd() {
  printf "[clangd]: install\n"
  paru -S clang --noconfirm 
  printf "[clangd]: done\n\n"
}

_install_shellcheck() {
  printf "[shellcheck]: install\n"
  paru -S shellcheck --noconfirm 
  printf "[shellcheck]: done\n\n"
}

_install_shfmt() {
  printf "[shfmt]: install\n"
  paru -S shfmt --noconfirm 
  printf "[shfmt]: done\n\n"
}

# install or update packages
main() {
  _update_paru_package_database

  # install or update neovim
  # _install_neovim
  _install_treesitter

  # install node provider
  _install_volta
  _install_node
  _install_node_provider

  # install python provider
  _install_python
  _install_pip
  _install_python_provider

  # install ruby provider
  _install_ruby
  _install_gem
  _install_ruby_provider

  # lsp servers & utils
  _install_sumneko_lua
  _install_efm
  _install_clangd
  _install_go
  _install_gopls
  _install_shellcheck
  _install_shfmt
  _install_npm_packages
}

main
